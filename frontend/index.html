<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GMB Scraper Pro v2.0</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* Estilos adicionales para v2 */
    .tabs { display: flex; gap: 0; margin-bottom: 20px; border-bottom: 2px solid #e0e0e0; }
    .tab { padding: 12px 24px; cursor: pointer; border: none; background: none; color: #666; font-size: 14px; font-weight: 500; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
    .tab:hover { color: #4285F4; }
    .tab.active { color: #4285F4; border-bottom-color: #4285F4; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .filters-section { background: #f8f9fa; border-radius: 8px; padding: 16px; margin-top: 16px; }
    .filters-title { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; cursor: pointer; }
    .filters-title::before { content: ''; width: 0; height: 0; border-left: 5px solid transparent; border-right: 5px solid transparent; border-top: 6px solid #666; transition: transform 0.2s; }
    .filters-title.collapsed::before { transform: rotate(-90deg); }
    .filters-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; }
    .filters-content { display: block; }
    .filters-content.collapsed { display: none; }
    
    .filter-group { display: flex; flex-direction: column; gap: 4px; }
    .filter-group label { font-size: 12px; color: #666; }
    .filter-group input, .filter-group select { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
    .filter-group input[type="checkbox"] { width: auto; }
    
    .checkbox-row { display: flex; align-items: center; gap: 8px; }
    .checkbox-row label { font-size: 13px; color: #333; cursor: pointer; }
    
    .geo-inputs { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
    .geo-inputs .form-group { margin-bottom: 0; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 20px; }
    .stat-card { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; text-align: center; }
    .stat-value { font-size: 24px; font-weight: 700; color: #4285F4; }
    .stat-label { font-size: 12px; color: #666; margin-top: 4px; }
    
    .results-table th, .results-table td { font-size: 12px; padding: 8px 6px; }
    .badge { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; }
    .badge-email { background: #e3f2fd; color: #1976d2; }
    .badge-phone { background: #e8f5e9; color: #388e3c; }
    .badge-social { background: #fce4ec; color: #c2185b; }
    
    .social-icons { display: flex; gap: 4px; }
    .social-icon { width: 20px; height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; text-decoration: none; color: white; }
    .social-icon.ig { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); }
    .social-icon.fb { background: #1877f2; }
    .social-icon.wa { background: #25d366; }
    .social-icon.tw { background: #1da1f2; }
    
    .version-badge { background: #4285F4; color: white; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px; }
    
    .preview-section { margin: 20px 0; }
    .preview-card { background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid #4285F4; border-radius: 16px; padding: 32px; text-align: center; animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .preview-icon { font-size: 48px; margin-bottom: 12px; }
    .preview-card h3 { color: #1e40af; margin: 0 0 16px; font-size: 18px; }
    .preview-count { margin: 20px 0; }
    .preview-count span:first-child { font-size: 56px; font-weight: 800; color: #4285F4; display: block; line-height: 1; }
    .preview-label { font-size: 16px; color: #666; }
    .preview-samples { margin: 20px 0; padding: 16px; background: white; border-radius: 8px; text-align: left; }
    .preview-samples p { margin: 0 0 8px; font-size: 12px; color: #666; font-weight: 600; }
    .preview-samples ul { margin: 0; padding-left: 20px; }
    .preview-samples li { font-size: 13px; color: #333; margin: 4px 0; }
    .preview-actions { display: flex; justify-content: center; gap: 12px; margin-top: 20px; }
    .button-group { display: flex; gap: 12px; }
    
    /* Estilos para autocomplete */
    .autocomplete-wrapper { position: relative; }
    .autocomplete-wrapper input { width: 100%; }
    input::-webkit-calendar-picker-indicator { display: none !important; }
    input[list]::-webkit-list-button { display: none !important; }
    
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span style="color:#4285F4">G</span><span style="color:#EA4335">M</span><span style="color:#FBBC04">B</span>
      </div>
      <h1>Google My Business Scraper <span class="version-badge">PRO v2.0</span></h1>
      <p class="subtitle">Extrae 40+ campos de negocios incluyendo emails y redes sociales</p>
    </header>

    <main>
      <!-- Google Sheets Status -->
      <section id="googleSection" class="google-section">
        <div class="google-status">
          <span id="googleIcon" class="google-icon"></span>
          <span id="googleStatusText">Verificando Google Sheets...</span>
          <button id="googleConnectBtn" class="btn btn-google" style="display: none;">Conectar Google Sheets</button>
        </div>
      </section>

      <!-- Tabs de busqueda -->
      <section class="search-section">
        <div class="tabs">
          <button class="tab active" data-tab="ciudad">Buscar por Ciudad</button>
          <button class="tab" data-tab="geo">Buscar por Coordenadas</button>
        </div>

        <form id="searchForm">
          <!-- Tab Ciudad -->
          <div class="tab-content active" id="tab-ciudad">
            <div class="form-group">
              <label for="businessType">Tipo de Negocio</label>
              <input type="text" id="businessType" name="businessType" placeholder="ej: plomeria, electricistas, restaurantes..." required minlength="2">
            </div>
            
            <div class="form-row">
              <div class="form-group">
                <label for="state">Estado</label>
                <div class="autocomplete-wrapper">
                  <input type="text" id="state" name="state" list="statesList" placeholder="Escribe para buscar..." autocomplete="off">
                  <datalist id="statesList">
                    <option value="Aguascalientes">
                    <option value="Baja California">
                    <option value="Baja California Sur">
                    <option value="Campeche">
                    <option value="Chiapas">
                    <option value="Chihuahua">
                    <option value="Ciudad de Mexico">
                    <option value="Coahuila">
                    <option value="Colima">
                    <option value="Durango">
                    <option value="Estado de Mexico">
                    <option value="Guanajuato">
                    <option value="Guerrero">
                    <option value="Hidalgo">
                    <option value="Jalisco">
                    <option value="Michoacan">
                    <option value="Morelos">
                    <option value="Nayarit">
                    <option value="Nuevo Leon">
                    <option value="Oaxaca">
                    <option value="Puebla">
                    <option value="Queretaro">
                    <option value="Quintana Roo">
                    <option value="San Luis Potosi">
                    <option value="Sinaloa">
                    <option value="Sonora">
                    <option value="Tabasco">
                    <option value="Tamaulipas">
                    <option value="Tlaxcala">
                    <option value="Veracruz">
                    <option value="Yucatan">
                    <option value="Zacatecas">
                  </datalist>
                </div>
              </div>
              <div class="form-group">
                <label for="city">Ciudad</label>
                <div class="autocomplete-wrapper">
                  <input type="text" id="city" name="city" list="citiesList" placeholder="Escribe para buscar..." required minlength="2" autocomplete="off">
                  <datalist id="citiesList">
                    <!-- Ciudades principales de Mexico -->
                    <option value="Ciudad de Mexico">
                    <option value="Guadalajara">
                    <option value="Monterrey">
                    <option value="Puebla">
                    <option value="Tijuana">
                    <option value="Leon">
                    <option value="Juarez">
                    <option value="Zapopan">
                    <option value="Nezahualcoyotl">
                    <option value="Merida">
                    <option value="San Luis Potosi">
                    <option value="Aguascalientes">
                    <option value="Hermosillo">
                    <option value="Saltillo">
                    <option value="Mexicali">
                    <option value="Culiacan">
                    <option value="Queretaro">
                    <option value="Morelia">
                    <option value="Chihuahua">
                    <option value="Cancun">
                    <option value="Acapulco">
                    <option value="Tlalnepantla">
                    <option value="Torreon">
                    <option value="Toluca">
                    <option value="Durango">
                    <option value="Tuxtla Gutierrez">
                    <option value="Mazatlan">
                    <option value="Irapuato">
                    <option value="Reynosa">
                    <option value="Villahermosa">
                    <option value="Matamoros">
                    <option value="Veracruz">
                    <option value="Xalapa">
                    <option value="Oaxaca">
                    <option value="Celaya">
                    <option value="Tampico">
                    <option value="Cuernavaca">
                    <option value="Ensenada">
                    <option value="Los Mochis">
                    <option value="Tepic">
                    <option value="Playa del Carmen">
                    <option value="Pachuca">
                    <option value="Campeche">
                    <option value="La Paz">
                    <option value="Cabo San Lucas">
                    <option value="Puerto Vallarta">
                    <option value="Colima">
                    <option value="Zacatecas">
                    <option value="Tlaxcala">
                    <option value="Chetumal">
                    <option value="Nogales">
                    <option value="Nuevo Laredo">
                    <option value="Ciudad Obregon">
                    <option value="Ciudad Victoria">
                    <option value="Guaymas">
                    <option value="Navojoa">
                    <option value="Guasave">
                    <option value="Salamanca">
                    <option value="Silao">
                    <option value="Tehuacan">
                    <option value="San Juan del Rio">
                    <option value="Uruapan">
                    <option value="Zamora">
                    <option value="Lazaro Cardenas">
                    <option value="Piedras Negras">
                    <option value="Monclova">
                    <option value="Delicias">
                    <option value="Cuauhtemoc">
                    <option value="Parral">
                    <option value="Fresnillo">
                    <option value="Rio Bravo">
                    <option value="Altamira">
                    <option value="Ciudad Madero">
                    <option value="Poza Rica">
                    <option value="Coatzacoalcos">
                    <option value="Minatitlan">
                    <option value="Cordoba">
                    <option value="Orizaba">
                    <option value="San Cristobal de las Casas">
                    <option value="Tapachula">
                    <option value="Comitan">
                    <option value="Chetumal">
                    <option value="Cozumel">
                    <option value="Tulum">
                    <option value="Valladolid">
                    <option value="Progreso">
                    <option value="Ecatepec">
                    <option value="Naucalpan">
                    <option value="Cuautitlan Izcalli">
                    <option value="Atizapan">
                    <option value="Coacalco">
                    <option value="Tultitlan">
                    <option value="Ixtapaluca">
                    <option value="Chalco">
                    <option value="Texcoco">
                    <option value="Teotihuacan">
                    <option value="San Pedro Garza Garcia">
                    <option value="Santa Catarina">
                    <option value="Apodaca">
                    <option value="Escobedo">
                    <option value="Guadalupe">
                    <option value="San Nicolas de los Garza">
                    <option value="Tonala">
                    <option value="Tlaquepaque">
                    <option value="Tlajomulco">
                    <option value="El Salto">
                    <option value="Lagos de Moreno">
                    <option value="Tepatitlan">
                    <option value="Ocotlan">
                    <option value="Arandas">
                    <option value="Autlan">
                    <option value="Chapala">
                    <option value="Tequila">
                  </datalist>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="country">Pais</label>
              <input type="text" id="country" name="country" value="Mexico" required minlength="2">
            </div>
          </div>

          <!-- Tab Geolocalizacion -->
          <div class="tab-content" id="tab-geo">
            <div class="form-group">
              <label for="businessTypeGeo">Tipo de Negocio</label>
              <input type="text" id="businessTypeGeo" name="businessTypeGeo" placeholder="ej: plomeria, electricistas...">
            </div>
            <div class="geo-inputs">
              <div class="form-group">
                <label for="latitude">Latitud</label>
                <input type="text" id="latitude" name="latitude" placeholder="ej: 25.6866">
              </div>
              <div class="form-group">
                <label for="longitude">Longitud</label>
                <input type="text" id="longitude" name="longitude" placeholder="ej: -100.3161">
              </div>
              <div class="form-group">
                <label for="radius">Radio (km)</label>
                <input type="number" id="radius" name="radius" placeholder="5" min="0.5" max="50" step="0.5" value="5">
              </div>
            </div>
            <p style="font-size: 12px; color: #666; margin-top: 8px;">Tip: Busca las coordenadas en Google Maps y copialas aqui</p>
          </div>

          <!-- Cantidad de resultados -->
          <div class="form-group">
            <label for="maxResults">Cantidad de resultados</label>
            <select id="maxResults" name="maxResults">
              <option value="10">10 negocios</option>
              <option value="25">25 negocios</option>
              <option value="50" selected>50 negocios</option>
              <option value="100">100 negocios</option>
              <option value="150">150 negocios</option>
              <option value="200">200 negocios</option>
            </select>
          </div>

          <!-- Opciones avanzadas -->
          <div class="filters-section">
            <div class="filters-title" id="filtersToggle">Opciones avanzadas</div>
            <div class="filters-content" id="filtersContent">
              <div class="filters-grid">
                <div class="checkbox-row">
                  <input type="checkbox" id="extractEmails" name="extractEmails" checked>
                  <label for="extractEmails">Extraer emails</label>
                </div>
                <div class="checkbox-row">
                  <input type="checkbox" id="extractSocial" name="extractSocial" checked>
                  <label for="extractSocial">Extraer redes sociales</label>
                </div>
              </div>
              
              <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e0e0e0;">
                <p style="font-size: 12px; font-weight: 600; color: #333; margin-bottom: 8px;">Filtros de resultados</p>
                <div class="filters-grid">
                  <div class="filter-group">
                    <label for="minRating">Rating minimo</label>
                    <select id="minRating" name="minRating">
                      <option value="">Sin filtro</option>
                      <option value="3">3+ estrellas</option>
                      <option value="3.5">3.5+ estrellas</option>
                      <option value="4">4+ estrellas</option>
                      <option value="4.5">4.5+ estrellas</option>
                    </select>
                  </div>
                  <div class="filter-group">
                    <label for="minReviews">Resenas minimas</label>
                    <select id="minReviews" name="minReviews">
                      <option value="">Sin filtro</option>
                      <option value="5">5+ resenas</option>
                      <option value="10">10+ resenas</option>
                      <option value="25">25+ resenas</option>
                      <option value="50">50+ resenas</option>
                      <option value="100">100+ resenas</option>
                    </select>
                  </div>
                  <div class="checkbox-row">
                    <input type="checkbox" id="requirePhone" name="requirePhone">
                    <label for="requirePhone">Solo con telefono</label>
                  </div>
                  <div class="checkbox-row">
                    <input type="checkbox" id="requireWebsite" name="requireWebsite">
                    <label for="requireWebsite">Solo con sitio web</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Google Sheets option -->
          <div class="form-group checkbox-group" id="sheetsOptionGroup" style="display: none; margin-top: 16px;">
            <label class="checkbox-label">
              <input type="checkbox" id="exportToSheets" name="exportToSheets" checked>
              <span class="checkmark"></span>
              Guardar automaticamente en Google Sheets
            </label>
          </div>


          <div class="button-group" style="display: flex; gap: 12px;">
            <button type="button" id="previewBtn" class="btn btn-secondary">
              <span class="btn-text">Vista Previa</span>
              <span class="btn-loading" style="display: none;">
                <span class="spinner"></span>
                Contando...
              </span>
            </button>
            <button type="submit" id="searchBtn" class="btn btn-primary">
              <span class="btn-text">Buscar Negocios</span>
              <span class="btn-loading" style="display: none;">
                <span class="spinner"></span>
                Buscando...
              </span>
            </button>
          </div>
        </form>
      </section>

      <!-- Preview Results -->
      <section id="previewSection" class="preview-section" style="display: none;">
        <div class="preview-card">
          <div class="preview-icon">&#128269;</div>
          <h3 id="previewTitle">Vista Previa</h3>
          <div class="preview-count">
            <span id="previewCount">0</span>
            <span class="preview-label">negocios encontrados</span>
          </div>
          <div id="previewSamples" class="preview-samples"></div>
          <div class="preview-actions">
            <button id="previewCancel" class="btn btn-secondary">Cancelar</button>
            <button id="previewConfirm" class="btn btn-primary">Iniciar Scraping</button>
          </div>
        </div>
      </section>
      </section>

      <!-- Progress -->
      <section id="progressSection" class="progress-section" style="display: none;">
        <div class="progress-info">
          <span id="progressText">Iniciando scraping...</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div id="progressFill" class="progress-fill"></div>
        </div>
      </section>

      <!-- Messages -->
      <section id="messageSection" class="message-section" style="display: none;">
        <div id="messageBox" class="message-box"></div>
      </section>

      <!-- Stats -->
      <section id="statsSection" style="display: none;">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="statTotal">0</div>
            <div class="stat-label">Total</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statPhone">0</div>
            <div class="stat-label">Con Telefono</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statEmail">0</div>
            <div class="stat-label">Con Email</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statWebsite">0</div>
            <div class="stat-label">Con Web</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statInstagram">0</div>
            <div class="stat-label">Instagram</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statWhatsapp">0</div>
            <div class="stat-label">WhatsApp</div>
          </div>
        </div>
      </section>

      <!-- Results -->
      <section id="resultsSection" class="results-section" style="display: none;">
        <div class="results-header">
          <div class="results-info">
            <h2>Resultados</h2>
            <span id="resultsCount" class="results-count"></span>
          </div>
          <div class="export-buttons">
            <button id="exportSheets" class="btn btn-google">Ver Google Sheets</button>
            <button id="exportCsv" class="btn btn-secondary">CSV</button>
            <button id="exportJson" class="btn btn-secondary">JSON</button>
          </div>
        </div>

        <div class="table-container">
          <table id="resultsTable" class="results-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Nombre</th>
                <th>Rating</th>
                <th>Categoria</th>
                <th>Telefono</th>
                <th>Email</th>
                <th>Redes</th>
                <th>Web</th>
                <th>Perfil</th>
              </tr>
            </thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>
      </section>

      <!-- Database Section -->
      <section id="databaseSection" class="database-section">
        <div class="db-header" id="dbToggle">
          <h3>Base de Datos Local</h3>
          <span class="db-toggle-icon">+</span>
        </div>
        <div id="dbContent" class="db-content" style="display: none;">
          <div class="db-stats-grid">
            <div class="db-stat-card">
              <span class="db-stat-number" id="dbTotalNegocios">0</span>
              <span class="db-stat-label">Total Negocios</span>
            </div>
            <div class="db-stat-card">
              <span class="db-stat-number" id="dbTotalCiudades">0</span>
              <span class="db-stat-label">Ciudades</span>
            </div>
            <div class="db-stat-card">
              <span class="db-stat-number" id="dbTotalCategorias">0</span>
              <span class="db-stat-label">Categorias</span>
            </div>
            <div class="db-stat-card">
              <span class="db-stat-number" id="dbTotalBusquedas">0</span>
              <span class="db-stat-label">Busquedas</span>
            </div>
          </div>
          
          <div class="db-details">
            <div class="db-detail-row">
              <span>Con telefono:</span>
              <strong id="dbConTelefono">0</strong>
            </div>
            <div class="db-detail-row">
              <span>Con email:</span>
              <strong id="dbConEmail">0</strong>
            </div>
            <div class="db-detail-row">
              <span>Con website:</span>
              <strong id="dbConWebsite">0</strong>
            </div>
            <div class="db-detail-row">
              <span>Rating promedio:</span>
              <strong id="dbRatingPromedio">0</strong>
            </div>
          </div>

          <div class="db-actions">
            <button id="dbRefresh" class="btn btn-secondary btn-sm">Actualizar</button>
            <button id="dbExport" class="btn btn-secondary btn-sm">Exportar Todo</button>
            <button id="dbLimpiar" class="btn btn-danger btn-sm">Limpiar Duplicados</button>
          </div>

          <div class="db-search">
            <input type="text" id="dbSearchInput" placeholder="Buscar en mis datos..." class="input-field">
            <button id="dbSearchBtn" class="btn btn-primary btn-sm">Buscar</button>
          </div>

          <div id="dbSearchResults" class="db-search-results" style="display: none;">
            <h4>Resultados de busqueda: <span id="dbSearchCount">0</span></h4>
            <div id="dbSearchList" class="db-search-list"></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      <p>GMB Scraper Pro v2.0 - 40+ campos por negocio</p>
    </footer>
  </div>

  <script>
    // Actualizar ciudades segun el estado seleccionado
    const citiesByState = {
      'Aguascalientes': ['Aguascalientes', 'Calvillo', 'Jesus Maria', 'Rincon de Romos', 'Pabellon de Arteaga'],
      'Baja California': ['Tijuana', 'Mexicali', 'Ensenada', 'Rosarito', 'Tecate', 'San Quintin'],
      'Baja California Sur': ['La Paz', 'Cabo San Lucas', 'San Jose del Cabo', 'Loreto', 'Ciudad Constitucion'],
      'Campeche': ['Campeche', 'Ciudad del Carmen', 'Champoton', 'Escarcega', 'Calkini'],
      'Chiapas': ['Tuxtla Gutierrez', 'San Cristobal de las Casas', 'Tapachula', 'Comitan', 'Palenque', 'Chiapa de Corzo'],
      'Chihuahua': ['Chihuahua', 'Juarez', 'Delicias', 'Cuauhtemoc', 'Parral', 'Nuevo Casas Grandes'],
      'Ciudad de Mexico': ['Ciudad de Mexico', 'Coyoacan', 'Xochimilco', 'Tlalpan', 'Iztapalapa', 'Gustavo A. Madero'],
      'Coahuila': ['Saltillo', 'Torreon', 'Monclova', 'Piedras Negras', 'Acuna', 'Sabinas'],
      'Colima': ['Colima', 'Manzanillo', 'Tecoman', 'Villa de Alvarez', 'Armeria'],
      'Durango': ['Durango', 'Gomez Palacio', 'Lerdo', 'Santiago Papasquiaro', 'CanatlÃ¡n'],
      'Estado de Mexico': ['Toluca', 'Ecatepec', 'Nezahualcoyotl', 'Naucalpan', 'Tlalnepantla', 'Cuautitlan Izcalli', 'Atizapan', 'Texcoco', 'Chalco'],
      'Guanajuato': ['Leon', 'Irapuato', 'Celaya', 'Salamanca', 'Silao', 'Guanajuato', 'San Miguel de Allende', 'Dolores Hidalgo'],
      'Guerrero': ['Acapulco', 'Chilpancingo', 'Iguala', 'Taxco', 'Zihuatanejo', 'Ixtapa'],
      'Hidalgo': ['Pachuca', 'Tulancingo', 'Tula', 'Huejutla', 'Tizayuca', 'Actopan'],
      'Jalisco': ['Guadalajara', 'Zapopan', 'Tlaquepaque', 'Tonala', 'Tlajomulco', 'Puerto Vallarta', 'Lagos de Moreno', 'Tepatitlan', 'Chapala', 'Tequila'],
      'Michoacan': ['Morelia', 'Uruapan', 'Zamora', 'Lazaro Cardenas', 'Apatzingan', 'Patzcuaro', 'Zitacuaro'],
      'Morelos': ['Cuernavaca', 'Jiutepec', 'Cuautla', 'Temixco', 'Yautepec', 'Tepoztlan'],
      'Nayarit': ['Tepic', 'Bahia de Banderas', 'Compostela', 'Santiago Ixcuintla', 'San Blas', 'Sayulita'],
      'Nuevo Leon': ['Monterrey', 'San Pedro Garza Garcia', 'San Nicolas de los Garza', 'Guadalupe', 'Apodaca', 'Santa Catarina', 'Escobedo'],
      'Oaxaca': ['Oaxaca', 'Salina Cruz', 'Juchitan', 'Tuxtepec', 'Huatulco', 'Puerto Escondido'],
      'Puebla': ['Puebla', 'Tehuacan', 'San Martin Texmelucan', 'Atlixco', 'Cholula', 'Izucar de Matamoros'],
      'Queretaro': ['Queretaro', 'San Juan del Rio', 'Corregidora', 'El Marques', 'Tequisquiapan'],
      'Quintana Roo': ['Cancun', 'Playa del Carmen', 'Chetumal', 'Cozumel', 'Tulum', 'Isla Mujeres', 'Puerto Morelos'],
      'San Luis Potosi': ['San Luis Potosi', 'Soledad de Graciano Sanchez', 'Ciudad Valles', 'Matehuala', 'Rioverde'],
      'Sinaloa': ['Culiacan', 'Mazatlan', 'Los Mochis', 'Guasave', 'Navolato', 'El Rosario'],
      'Sonora': ['Hermosillo', 'Ciudad Obregon', 'Nogales', 'Guaymas', 'San Luis Rio Colorado', 'Navojoa', 'Puerto Penasco'],
      'Tabasco': ['Villahermosa', 'Cardenas', 'Comalcalco', 'Paraiso', 'Macuspana'],
      'Tamaulipas': ['Reynosa', 'Matamoros', 'Nuevo Laredo', 'Tampico', 'Ciudad Victoria', 'Ciudad Madero', 'Altamira'],
      'Tlaxcala': ['Tlaxcala', 'Apizaco', 'Huamantla', 'Chiautempan', 'Calpulalpan'],
      'Veracruz': ['Veracruz', 'Xalapa', 'Coatzacoalcos', 'Poza Rica', 'Cordoba', 'Orizaba', 'Minatitlan', 'Boca del Rio'],
      'Yucatan': ['Merida', 'Valladolid', 'Progreso', 'Tizimin', 'Izamal', 'Uman'],
      'Zacatecas': ['Zacatecas', 'Fresnillo', 'Guadalupe', 'Jerez', 'Rio Grande', 'Sombrerete']
    };

    const stateInput = document.getElementById('state');
    const cityInput = document.getElementById('city');
    const citiesList = document.getElementById('citiesList');

    stateInput.addEventListener('change', function() {
      const selectedState = this.value;
      const cities = citiesByState[selectedState] || [];
      
      // Limpiar lista actual
      citiesList.innerHTML = '';
      
      // Agregar ciudades del estado seleccionado
      cities.forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        citiesList.appendChild(option);
      });
      
      // Limpiar campo de ciudad y enfocarlo
      cityInput.value = '';
      cityInput.focus();
    });

    // Si escriben directamente en ciudad sin seleccionar estado, mostrar todas
    cityInput.addEventListener('focus', function() {
      if (!stateInput.value) {
        // Restaurar todas las ciudades si no hay estado seleccionado
        const allCities = Object.values(citiesByState).flat().sort();
        const uniqueCities = [...new Set(allCities)];
        citiesList.innerHTML = '';
        uniqueCities.forEach(city => {
          const option = document.createElement('option');
          option.value = city;
          citiesList.appendChild(option);
        });
      }
    });
  </script>
  <script src="app-advanced.js"></script>
</body>
</html>
